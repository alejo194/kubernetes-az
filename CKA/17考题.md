##### 1 RBAC
```bash
kubectl create clusterrole deployment-clusterrole --verb=create --resource=deployment,statefulsets,daemonsets

kubectl create sa cicd-token -n app-team1

kubectl create rolebinding cicd-token-binding --clusterrole=deployment-clusterrole --serviceaccount=app-team1:cicd-token --namespace=app-team1
```
##### 2 节点维护
+ 将ek8s-node-1节点设置为不可用，然后重新调度该节点上的所有Pod
```bash
kubectl config use-context ek8s
kubectl cordon ek8s-node-1 # 设置节点不可调度状态
kubectl drain ek8s-node-1 --delete-emptydir-data --ignore-daemonsets --force # 驱逐ek8s-node-1 所有的pod
```
##### 3 节点升级
+ 升级主节点及kubectl，kubelet.注意其他etcd,containerd,dns不需要升级
```bash
#设置为维护状态
$ kubectl config use-context mk8s
$ kubectl get no
$ kubectl cordon k8s-master
$ kubectl drain k8s-master --delete-emptydir-data --ignore-daemonsets --force

#安装题目提示ssh到一个master节点
$ ssh mk8s-master
$ apt update
$ apt-cache policy kubeadm |grep 1.19.0
$ apt-get install kubeadm=1.19.0-00

#验证升级计划
$ kubeadm upgrade plan
# 看到如下信息，可升级到指定版本
You can now apply the upgrade by executing the following command.
        kubeadm upgrade apply v1.19.0
        # 开始升级Master节点
        $ kubeadm upgrade apply v1.19.0 --etcd-upgrade=false
        [upgrade/sucdessful] SUCCESS Your cluster was upgraded to 'v1.19.0'.EnJoy
        
        [upgrade/kubelet] Now that your control plane is upgraded, please proceed with upgrading your kubelets if you haven't already done so.
        
        #升级kubectl和kubelet
        $ apt-get install -y kubelet=1.19.0-00 kubectl=1.19.0-00
        $ systemctl daemon-reload
        $ systemctl restart kubelet
        
        $ kubectl uncordon k8s-master
        node/k8s-master uncordoned
        
        $ kubectl get node
```
